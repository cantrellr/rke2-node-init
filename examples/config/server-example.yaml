apiVersion: rkeprep/v1
kind: Server
metadata:
  name: rke2-server-01
  description: First RKE2 control-plane server node

spec:
  # Hostname for this node
  hostname: rke2-server-01
  
  # Network interface configuration
  interfaces:
    - name: eth0
      ip: 10.0.100.10
      prefix: 24
      gateway: 10.0.100.1
      dns:
        - 10.0.0.10
        - 10.0.0.11
      searchDomains:
        - cluster.local
        - example.com
      mtu: 1500
      metric: 100
  
  # RKE2 configuration
  rke2:
    version: v1.34.1+rke2r1

    # TLS SANs for API server certificate (camelCase preferred; kebab-case aliases are supported)
    tlsSans:
      - rke2-api.example.com
      - 10.0.100.10
      - 10.0.100.100  # VIP for load balancer

  # Cluster CIDR (pod network)
  clusterCidr: 10.42.0.0/16

  # Service CIDR
  serviceCidr: 10.43.0.0/16

  # Cluster DNS
  clusterDns: 10.43.0.10

  # Cluster domain
  clusterDomain: cluster.local
  
  # Private registry configuration
  registry:
    endpoint: registry.example.com:5000/rke2
    username: rke2-reader
    password: CHANGE-ME
  
  # Custom CA certificate
  caCertPath: /path/to/ca.crt

---
# Multi-interface server example
apiVersion: rkeprep/v1
kind: Server
metadata:
  name: rke2-server-multi-nic
  description: Control-plane with multiple network interfaces

spec:
  hostname: rke2-server-multi
  
  # Multiple network interfaces
  interfaces:
    # Management interface
    - name: eth0
      ip: 10.0.100.10
      prefix: 24
      gateway: 10.0.100.1
      dns:
        - 10.0.0.10
        - 10.0.0.11
      searchDomains:
        - mgmt.example.com
      metric: 100
    
    # Cluster communication interface
    - name: eth1
      ip: 192.168.1.10
      prefix: 24
      mtu: 9000  # Jumbo frames
      metric: 200
    
    # Storage network interface
    - name: eth2
      ip: 172.16.0.10
      prefix: 24
      mtu: 9000
      metric: 300
  
  rke2:
    version: v1.34.1+rke2r1

    # Bind to cluster communication interface (camelCase preferred; kebab-case aliases are supported)
    nodeIp: 192.168.1.10
    bindAddress: 192.168.1.10
    advertiseAddress: 192.168.1.10

    tlsSans:
      - rke2-api.example.com
      - 192.168.1.10
      - 192.168.1.100  # VIP
  
  registry:
    endpoint: registry.example.com:5000/rke2
    username: rke2-reader
    password: CHANGE-ME

---
# Minimal server configuration
apiVersion: rkeprep/v1
kind: Server
metadata:
  name: simple-server

spec:
  hostname: rke2-server-simple
  
  interfaces:
    - name: eth0
      ip: 10.0.100.20
      prefix: 24
      gateway: 10.0.100.1
      dns: [8.8.8.8, 8.8.4.4]
  
  rke2:
    version: v1.34.1+rke2r1
    tlsSans:
      - 10.0.100.20

---
# HA server with load balancer
apiVersion: rkeprep/v1
kind: Server
metadata:
  name: rke2-server-ha-01
  description: HA control-plane node behind load balancer

spec:
  hostname: rke2-server-ha-01
  
  interfaces:
    - name: eth0
      ip: 10.0.100.11
      prefix: 24
      gateway: 10.0.100.1
      dns: [10.0.0.10, 10.0.0.11]
      searchDomains: [k8s.example.com, example.com]
  
  rke2:
    version: v1.34.1+rke2r1

    # Multiple TLS SANs for HA (camelCase preferred; kebab-case aliases supported)
    tlsSans:
      - rke2-api.example.com      # Load balancer DNS
      - 10.0.100.100               # Load balancer VIP
      - rke2-server-ha-01.k8s.example.com
      - 10.0.100.11                # This server's IP
      - rke2-server-ha-02.k8s.example.com
      - 10.0.100.12                # Other server IPs
      - rke2-server-ha-03.k8s.example.com
      - 10.0.100.13
    
  clusterCidr: 10.42.0.0/16
  serviceCidr: 10.43.0.0/16
  
  registry:
    endpoint: registry.example.com:5000/rke2
    username: rke2-reader
    password: CHANGE-ME
  
  caCertPath: /etc/ssl/certs/company-ca.crt
